
/* ------------------------------------------------ */
/* -- jQuery FlexMenu Plugin V 1.1 -- */
/* ------------------------------------------------ */

// Developer Note: Added submenu support by changing .find() to .children()

(function(e){function r(){e(t).each(function(){e(this).flexMenu({undo:true}).flexMenu(this.options)})}function i(t){var n,r;n=e("li.flexMenu-viewMore.active");r=n.not(t);r.removeClass("active").find("> ul").hide()}var t=[],n;e(window).resize(function(){clearTimeout(n);n=setTimeout(function(){r()},200)});e.fn.flexMenu=function(n){var r,s=e.extend({threshold:2,cutoff:2,linkText:"More",linkTitle:"View More",linkTextAll:"Menu",linkTitleAll:"Open/Close Menu",showOnHover:true,popupAbsolute:true,undo:false},n);this.options=s;r=e.inArray(this,t);if(r>=0)t.splice(r,1);else t.push(this);return this.each(function(){function y(e){var t=Math.ceil(e.offset().top)>=a+f?true:false;return t}var t=e(this),n=t,r=t.children("li:first-child"),o=t.children("li:last-child"),u=t.children("li").length,a=Math.floor(r.offset().top),f=Math.floor(r.outerHeight(true)),l,c,h,p,d,v=false,m,g;if(y(o)&&u>s.threshold&&!s.undo&&t.is(":visible")){var b=e('<ul class="flexMenu-popup" style="display:none;'+(s.popupAbsolute?" position: absolute;":"")+'"></ul>'),w=r.offset().top;for(g=u;g>1;g--){l=t.children("li:last-child");c=y(l);l.appendTo(b);if(g-1<=s.cutoff){e(t.children().get().reverse()).appendTo(b);v=true;break}if(!c)break}if(v)t.append('<li class="flexMenu-viewMore flexMenu-allInPopup"><a href="#" title="'+s.linkTitleAll+'">'+s.linkTextAll+"</a></li>");else t.append('<li class="flexMenu-viewMore"><a href="#" title="'+s.linkTitle+'">'+s.linkText+"</a></li>");h=t.find("li.flexMenu-viewMore");if(y(h))t.find("li:nth-last-child(2)").appendTo(b);b.children().each(function(e,t){b.prepend(t)});h.append(b);p=t.find("li.flexMenu-viewMore > a");p.click(function(e){i(h);b.toggle();h.toggleClass("active");e.preventDefault()});if(s.showOnHover&&typeof Modernizr!=="undefined"&&!Modernizr.touch)h.hover(function(){b.show();e(this).addClass("active")},function(){b.hide();e(this).removeClass("active")})}else if(s.undo&&t.find("ul.flexMenu-popup")){m=t.find("ul.flexMenu-popup");d=m.children("li").length;for(g=1;g<=d;g++)m.children("li:first-child").appendTo(t);m.remove();t.find("li.flexMenu-viewMore").remove()}})}})(jQuery);